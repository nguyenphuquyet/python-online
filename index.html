<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>NGUYENPHUQUYET - PYTHON ONLINE</title>

<meta name="description" content="Cháº¡y code python online khÃ´ng cáº§n cÃ i app">
<link rel="icon" href="https://images.icon-icons.com/1508/PNG/512/python_104451.png">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

<style>
html, body { height: 100%; }
textarea { overflow: hidden; }

.theme-active {
  outline: 2px solid #22c55e;
  outline-offset: 2px;
}

#overlay.hidden { pointer-events: none; }

/* ğŸ”‘ quan trá»ng cho keyboard fix */
#inputBar {
  will-change: transform;
}
</style>
</head>

<body class="h-[100dvh] overflow-hidden bg-black text-green-400">

<div class="flex flex-col h-full">

<!-- HEADER -->
<div id="header"
 class="flex items-center justify-between px-4 py-2 border-b text-sm font-mono">
  <div>Python 3.11 â€” Browser REPL</div>
  <button id="settingsBtn">âš™ï¸ CÃ i Ä‘áº·t</button>
</div>

<!-- TERMINAL -->
<div id="terminal"
 class="flex-1 overflow-y-auto px-4 py-3 font-mono space-y-1"></div>

<!-- INPUT -->
<div id="inputBar" class="border-t px-4 py-3">
  <div class="flex items-end gap-2">
    <span id="prompt" class="select-none">>>> </span>
    <textarea id="input" rows="1"
      class="flex-1 bg-transparent resize-none outline-none font-mono"
      placeholder="Nháº­p Python..."></textarea>
    <button id="runBtn"
      class="h-[1.5rem] px-3 rounded font-semibold">â–¶</button>
  </div>
</div>

</div>

<!-- OVERLAY -->
<div id="overlay" class="fixed inset-0 z-40 hidden"></div>

<!-- SIDEBAR -->
<aside id="sidebar"
 class="fixed top-0 right-0 h-full w-72 translate-x-full
        transition-transform z-50 flex flex-col">

  <div id="sidebarHeader"
   class="flex items-center justify-between px-4 py-3 border-b text-sm">
    <div>âš™ï¸ CÃ i Ä‘áº·t</div>
    <button id="closeSidebar">âœ•</button>
  </div>

  <div class="p-4 space-y-4 text-sm">
    <div>
      <div class="mb-2 font-medium">Theme</div>
      <div class="grid grid-cols-2 gap-2">
        <button data-theme="hacker" class="themeBtn px-3 py-2 rounded">Hacker</button>
        <button data-theme="dark" class="themeBtn px-3 py-2 rounded">Dark</button>
        <button data-theme="light" class="themeBtn px-3 py-2 rounded">Light</button>
        <button data-theme="midnight" class="themeBtn px-3 py-2 rounded">Midnight</button>
      </div>
    </div>

    <div id="credit" class="text-xs border-t pt-3">
      PhÃ¡t triá»ƒn bá»Ÿi Nguyá»…n PhÃº Quyáº¿t
    </div>
  </div>
</aside>

<!-- IN-APP WARNING -->
<div id="inAppWarning"
 class="fixed inset-0 z-[999] hidden bg-black/80
        flex items-center justify-center px-4">
  <div class="bg-black border border-red-500 rounded-lg p-4 max-w-sm w-full text-center">
    <div class="text-red-400 font-bold mb-2">âš ï¸ TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£</div>
    <div class="text-sm mb-4 text-gray-300">
      Trang khÃ´ng há»— trá»£ trÃ¬nh duyá»‡t tÃ­ch há»£p (Messenger / Facebook / Zalo)
    </div>
    <button id="openExternal"
     class="w-full bg-green-600 text-black font-semibold py-2 rounded">
      ğŸŒ Má»Ÿ báº±ng trÃ¬nh duyá»‡t ngoÃ i
    </button>
  </div>
</div>

<script>
/* ================= ELEMENTS ================= */
const terminal = document.getElementById("terminal");
const input = document.getElementById("input");
const runBtn = document.getElementById("runBtn");
const inputBar = document.getElementById("inputBar");
const promptEl = document.getElementById("prompt");
const header = document.getElementById("header");

const settingsBtn = document.getElementById("settingsBtn");
const sidebar = document.getElementById("sidebar");
const sidebarHeader = document.getElementById("sidebarHeader");
const overlay = document.getElementById("overlay");
const closeSidebar = document.getElementById("closeSidebar");
const credit = document.getElementById("credit");
const themeButtons = document.querySelectorAll(".themeBtn");

/* ================= TERMINAL ================= */
function printLine(text, type="output") {
  const div = document.createElement("div");
  div.className = type === "error" ? "text-red-500" : "";
  div.textContent = text;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

/* ================= PYODIDE ================= */
let pyodide;
(async () => {
  printLine("Äang táº£i Python...");
  pyodide = await loadPyodide();
  pyodide.setStdout({ batched: s => s.trim() && printLine(s) });
  pyodide.setStderr({ batched: s => s.trim() && printLine(s, "error") });
  terminal.innerHTML = "";
  printLine("Python 3.11 (Pyodide)");
})();

/* ================= RUN ================= */
runBtn.onclick = async () => {
  const code = input.value;
  if (!code.trim()) return;

  printLine(">>> " + code);
  input.value = "";
  autoResize();

  try {
    const r = await pyodide.runPythonAsync(code);
    if (r !== undefined) printLine(String(r));
  } catch (e) {
    printLine(e.toString(), "error");
  }
};

/* ================= AUTO RESIZE ================= */
function autoResize() {
  input.style.height = "1.5rem";
  input.style.height = input.scrollHeight + "px";
}
input.addEventListener("input", autoResize);

/* ================= ğŸ”‘ KEYBOARD FIX (FINAL) ================= */
const vv = window.visualViewport;

function adjustForKeyboard() {
  if (!vv) return;
  const keyboardHeight =
    window.innerHeight - vv.height - vv.offsetTop;

  if (keyboardHeight > 0) {
    inputBar.style.transform = `translateY(-${keyboardHeight}px)`;
  } else {
    inputBar.style.transform = "";
  }
}

if (vv) {
  vv.addEventListener("resize", adjustForKeyboard);
  vv.addEventListener("scroll", adjustForKeyboard);
}

input.addEventListener("focus", adjustForKeyboard);
input.addEventListener("blur", () => {
  inputBar.style.transform = "";
});

/* ================= SIDEBAR ================= */
settingsBtn.onclick = () => {
  sidebar.classList.remove("translate-x-full");
  overlay.classList.remove("hidden");
};
closeSidebar.onclick = overlay.onclick = () => {
  sidebar.classList.add("translate-x-full");
  overlay.classList.add("hidden");
};

/* ================= THEMES ================= */
const themes = {
  hacker: {
    body: "bg-black text-green-400",
    border: "border-green-700",
    prompt: "text-green-400",
    input: "text-green-400 placeholder-green-600",
    button: "bg-green-600 text-black hover:bg-green-500",
    sidebar: "bg-black text-green-400",
    overlay: "bg-black/50"
  },
  dark: {
    body: "bg-black text-gray-100",
    border: "border-gray-800",
    prompt: "text-blue-400",
    input: "text-gray-100 placeholder-gray-500",
    button: "bg-blue-600 text-white",
    sidebar: "bg-black text-gray-100",
    overlay: "bg-black/60"
  },
  light: {
    body: "bg-gray-100 text-gray-900",
    border: "border-gray-300",
    prompt: "text-blue-600",
    input: "text-gray-900 placeholder-gray-400",
    button: "bg-blue-600 text-white",
    sidebar: "bg-white text-gray-900",
    overlay: "bg-black/30"
  },
  midnight: {
    body: "bg-slate-950 text-slate-100",
    border: "border-slate-800",
    prompt: "text-cyan-400",
    input: "text-slate-100 placeholder-slate-500",
    button: "bg-cyan-600 text-black",
    sidebar: "bg-slate-950 text-slate-100",
    overlay: "bg-black/70"
  }
};

function applyTheme(name) {
  const t = themes[name];
  if (!t) return;

  document.body.className = `h-[100dvh] overflow-hidden ${t.body}`;
  header.className =
    `flex items-center justify-between px-4 py-2 border-b text-sm font-mono ${t.border}`;
  inputBar.className = `border-t px-4 py-3 ${t.border}`;
  promptEl.className = `${t.prompt} select-none`;
  input.className =
    `flex-1 bg-transparent resize-none outline-none font-mono ${t.input}`;
  runBtn.className =
    `h-[1.5rem] px-3 rounded font-semibold ${t.button}`;
  sidebar.className =
    `fixed top-0 right-0 h-full w-72 translate-x-full transition-transform z-50 flex flex-col ${t.sidebar}`;
  sidebarHeader.className =
    `flex items-center justify-between px-4 py-3 border-b text-sm ${t.border}`;
  credit.className = `text-xs border-t pt-3 ${t.border}`;
  overlay.className = `fixed inset-0 z-40 hidden ${t.overlay}`;

  themeButtons.forEach(btn =>
    btn.classList.toggle("theme-active", btn.dataset.theme === name)
  );

  localStorage.setItem("theme", name);
}

themeButtons.forEach(btn =>
  btn.onclick = () => applyTheme(btn.dataset.theme)
);

applyTheme(localStorage.getItem("theme") || "hacker");

/* ================= IN-APP BROWSER ================= */
function isInAppBrowser() {
  return /FBAN|FBAV|Messenger|Instagram|Zalo|Line|TikTok/i
    .test(navigator.userAgent);
}

if (isInAppBrowser()) {
  document.getElementById("inAppWarning").classList.remove("hidden");
  document.getElementById("openExternal").onclick = () => {
    const url = location.href.replace(/^https?:\/\//, "");
    if (/Android/i.test(navigator.userAgent)) {
      location.href =
        "intent://" + url +
        "#Intent;scheme=https;package=com.android.chrome;end";
    } else {
      alert("Nháº¥n â‹¯ â†’ Má»Ÿ báº±ng Safari");
    }
  };
}
</script>

</body>
</html>